# Render Environment Variables Reference

Quick reference for all environment variables needed for PULSE deployment on Render.com.

---

## ‚úÖ Auto-Configured (No Action Needed)

These are automatically set by Render from `render.yaml`:

| Variable | Value | Source |
|----------|-------|--------|
| `DATABASE_URL` | `postgresql://...` | Auto from pulse-postgres |
| `REDIS_HOST` | `pulse-redis-...onrender.com` | Auto from pulse-redis |
| `REDIS_PORT` | `6379` | Auto from pulse-redis |
| `JWT_SECRET` | Auto-generated | Render generateValue |
| `JWT_REFRESH_SECRET` | Auto-generated | Render generateValue |
| `NODE_ENV` | `production` | Set in render.yaml |
| `PORT` | `3001` | Set in render.yaml |

---

## ‚ö†Ô∏è MUST SET MANUALLY

### Critical - Required for Email

| Variable | Example Value | Where to Get |
|----------|---------------|--------------|
| **`RESEND_API_KEY`** | `re_abc123xyz456` | https://resend.com ‚Üí API Keys |

**How to Set**:
1. Render Dashboard ‚Üí pulse-api ‚Üí Environment
2. Find `RESEND_API_KEY`
3. Click Edit ‚Üí Paste your key
4. Save Changes

**Without this**: Email notifications won't work!

---

## üìã Optional Configuration

### Email Settings

| Variable | Default | Purpose |
|----------|---------|---------|
| `EMAIL_FROM` | `PULSE Monitoring <onboarding@resend.dev>` | From address in emails |

**To Use Custom Domain**:
```
EMAIL_FROM=PULSE Monitoring <noreply@yourdomain.com>
```
(Requires domain verification in Resend)

### JWT Settings

| Variable | Default | Purpose |
|----------|---------|---------|
| `JWT_EXPIRES_IN` | `7d` | Access token lifetime |
| `JWT_REFRESH_EXPIRES_IN` | `30d` | Refresh token lifetime |

### Rate Limiting

| Variable | Default | Purpose |
|----------|---------|---------|
| `RATE_LIMIT_WINDOW_MS` | `900000` | 15 minutes in ms |
| `RATE_LIMIT_MAX_REQUESTS` | `100` | Max requests per window |

### Logging

| Variable | Default | Purpose |
|----------|---------|---------|
| `LOG_LEVEL` | `info` | Logging verbosity (debug, info, warn, error) |

### Frontend URL (for Email Links)

| Variable | Default | Purpose |
|----------|---------|---------|
| `FRONTEND_URL` | `http://localhost:3000` | Used in email "View Incident" buttons |

**Update after deploying frontend**:
```
FRONTEND_URL=https://pulse-dashboard.onrender.com
```

---

## üîê Security Best Practices

### Production Checklist

- [x] `JWT_SECRET` - Auto-generated (verify it's not empty)
- [x] `JWT_REFRESH_SECRET` - Auto-generated (verify it's not empty)
- [x] `RESEND_API_KEY` - Keep secret, never commit to git
- [x] `DATABASE_URL` - Auto-configured, don't modify
- [ ] Change default password for `admin@pulse.local`
- [ ] Rotate JWT secrets periodically (every 90 days)

### What NOT to Do

‚ùå Don't commit `.env` to git
‚ùå Don't share API keys in public channels
‚ùå Don't use default/example values in production
‚ùå Don't hardcode secrets in code

---

## üìù Complete Environment Variable List

Copy this for reference:

```bash
# Auto-configured by Render
DATABASE_URL=postgresql://...
REDIS_HOST=pulse-redis-xxx.onrender.com
REDIS_PORT=6379
JWT_SECRET=<auto-generated>
JWT_REFRESH_SECRET=<auto-generated>
NODE_ENV=production
PORT=3001

# MUST SET MANUALLY
RESEND_API_KEY=re_your_actual_key_here

# Optional - Configure as needed
EMAIL_FROM=PULSE Monitoring <onboarding@resend.dev>
JWT_EXPIRES_IN=7d
JWT_REFRESH_EXPIRES_IN=30d
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100
LOG_LEVEL=info
FRONTEND_URL=http://localhost:3000
```

---

## üîÑ How to Update Variables

### In Render Dashboard

1. Go to https://dashboard.render.com
2. Click on **pulse-api** service
3. Click **Environment** tab
4. Find the variable you want to change
5. Click **Edit** next to it
6. Update the value
7. Click **Save Changes**

‚ö†Ô∏è **Service will automatically redeploy** after saving!

### Via Render CLI (Advanced)

```bash
# Install Render CLI
npm install -g @render/cli

# Login
render login

# Update variable
render env set RESEND_API_KEY=re_new_key --service pulse-api
```

---

## üß™ Testing Environment Variables

### Check if Variables are Set

```bash
# In Render Shell
echo $DATABASE_URL
echo $REDIS_HOST
echo $RESEND_API_KEY

# Verify JWT secrets exist (don't print them!)
[ -z "$JWT_SECRET" ] && echo "‚ùå JWT_SECRET not set" || echo "‚úÖ JWT_SECRET is set"
```

### Test Email Configuration

```bash
# Test endpoint (requires auth token)
curl -X POST https://pulse-api-xxx.onrender.com/api/v1/alert-contacts/:id/test \
  -H "Authorization: Bearer $TOKEN"

# Check logs for email send confirmation
# In Render Dashboard ‚Üí Logs tab
# Look for: "Email sent to ..."
```

---

## üö® Troubleshooting

### "RESEND_API_KEY not set"

**Symptoms**: Email notifications fail
**Solution**: Add `RESEND_API_KEY` in Environment tab

### "Database connection failed"

**Symptoms**: App won't start
**Solution**: Check `DATABASE_URL` is set correctly (should be auto-configured)

### "Redis connection failed"

**Symptoms**: Queues not working
**Solution**: Verify `REDIS_HOST` and `REDIS_PORT` are set

### "JWT token invalid"

**Symptoms**: Auth fails after deployment
**Solution**: JWT secrets were regenerated - users need to login again

---

## üìä Monitoring Variables

### View All Current Values

In Render Dashboard:
1. **Environment** tab
2. All variables listed
3. Values are hidden by default (click eye icon to reveal)

### Audit Trail

**Events** tab shows when variables were changed:
```
Feb 7, 2024 - Updated RESEND_API_KEY
Feb 6, 2024 - Updated EMAIL_FROM
```

---

## ‚úÖ Deployment Checklist

Before deploying:

- [ ] `RESEND_API_KEY` is set
- [ ] `JWT_SECRET` is auto-generated (verify)
- [ ] `DATABASE_URL` is auto-configured
- [ ] `REDIS_HOST` is auto-configured
- [ ] All required variables present
- [ ] No example/placeholder values
- [ ] Secrets not committed to git

After deploying:

- [ ] Test `/health` endpoint
- [ ] Test login
- [ ] Test email notification
- [ ] Check logs for errors
- [ ] Verify all workers running

---

## üéØ Quick Reference Card

**Critical Variables**:
```
RESEND_API_KEY      ‚Üê YOU MUST SET THIS
DATABASE_URL        ‚Üê Auto-configured
REDIS_HOST          ‚Üê Auto-configured
JWT_SECRET          ‚Üê Auto-generated
```

**Where to Set Them**:
```
Render Dashboard ‚Üí pulse-api ‚Üí Environment ‚Üí Edit
```

**How to Test**:
```
curl https://pulse-api-xxx.onrender.com/health
curl https://pulse-api-xxx.onrender.com/api/v1/auth/login
```

---

Need help? See [RENDER-DEPLOYMENT.md](RENDER-DEPLOYMENT.md) for full deployment guide.
